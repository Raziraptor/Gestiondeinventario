{% extends 'base.html' %}

{% block title %}Detalle de Salida #{{ salida.id }}{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h2>Detalle de Salida #{{ salida.id }}</h2>
            <h5 class="text-muted">Motivo: {{ salida.motivo }}</h5>
            <small>Fecha: {{ salida.fecha.strftime('%Y-%m-%d %H:%M') }}</Lsmall>
        </div>
        <div>
            <a href="{{ url_for('generar_salida_pdf', id=salida.id) }}" class="btn btn-danger" target="_blank">
                <i class="bi bi-file-earmark-pdf"></i> Imprimir PDF
            </a>
            
            {% if salida.estado != 'cancelada' %}
            <form action="{{ url_for('cancelar_salida', id=salida.id) }}" method="POST" style="display: inline;" 
                  onsubmit="return confirm('¿Estás seguro? Esta acción cancelará la salida y DEVOLVERÁ el stock al inventario.');">
                <button type="submit" class="btn btn-warning">
                    <i class="bi bi-x-circle"></i> Cancelar Salida
                </button>
            </form>
            {% endif %}

            <a href="{{ url_for('historial_salidas') }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver al Historial
            </a>
        </div>
    </div>
    
    {% if salida.estado == 'cancelada' %}
    <div class="alert alert-warning">
        <strong>Esta salida fue cancelada.</strong> El inventario asociado fue reingresado.
    </div>
    {% endif %}

    <div class="card">
        <div class="card-header">
            Productos Retirados
        </div>
        <div class="card-body table-responsive">

            <div class="row mb-3">
                <div class="col-md-6">
                    <strong>Creada por:</strong>
                    <i class="bi bi-person"></i> {{ salida.creador.username }}
                </div>
                {% if salida.estado == 'cancelada' and salida.cancelado_por %}
                <div class="col-md-6">
                    <strong>Cancelada por:</strong>
                    <i class="bi bi-person-x"></i> {{ salida.cancelado_por.username }}
                </div>
                {% endif %}
            </div>
            <table class="table table-striped">
        </div>
{% endblock %}